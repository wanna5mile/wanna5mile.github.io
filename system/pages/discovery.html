<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WannaSmile | Discovery</title>
  <link rel="icon" href="/system/images/favicons/logoo.png" />
  
  <!-- Styles -->
  <link rel="stylesheet" href="/system/css/themes.css" />
  <link rel="stylesheet" href="/system/css/main.css" />

  <style>
    main {
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-family: monospace;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: var(--link-color);
      transition: color 0.3s, text-decoration-color 0.3s;
    }
    h1:hover {
      color: var(--accent-color);
      text-decoration: underline;
      text-decoration-color: var(--accent-color);
    }

    /* Category Buttons */
    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .category-buttons button {
      background: var(--card-bg);
      color: var(--link-color);
      border: 1px solid transparent;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-family: monospace;
      transition: background 0.3s, color 0.3s, transform 0.2s;
    }
    .category-buttons button:hover {
      color: var(--accent-color);
      background: rgba(255,255,255,0.1);
      transform: scale(1.05);
    }

    /* Match global grid styling */
    #discoveryContainer {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      justify-items: center;
      gap: 20px;
      padding: 20px;
      min-height: 60vh;
    }
  </style>
</head>
<body theme="classic">

  <!-- Header -->
  <header>
    <nav class="nav-links">
      <a href="/index.html">Home</a>
      <a href="/favorites.html">Favorites</a>
      <a href="/system/pages/discovery.html" class="active">Discovery</a>
      <a href="/system/pages/settings.html">Settings</a>
      <a href="/system/pages/support.html">Support</a>
      <a href="/info.html">Info</a>
    </nav>

    <div class="header-controls">
      <div class="search-box">
        <input id="searchInput" type="text" placeholder="Search ϱames..." />
        <button id="searchBtn"><img src="/system/icons/search.png" alt="Search" /></button>
      </div>
      <a href="/system/pages/profile.html"><img id="pfp" src="/system/icons/profile.png" alt="Profile" /></a>
      <button id="dashboardBtn"><img src="/system/icons/dashboard.png" alt="Dashboard" /></button>
    </div>
  </header>

  <!-- Dashboard -->
  <aside id="dashboardMenu" class="dashboard-menu">
    <a href="/system/pages/music-player.html">Music Player</a>
    <a href="/system/pages/settings-themes.html">Themes</a>
    <a href="/system/pages/credits.html">Credits</a>
    <a href="/system/pages/alt.html">Alternative Links</a>
  </aside>

  <main>
    <h1>Discover ϱames</h1>

    <div class="category-buttons">
      <button data-category="Action">Action</button>
      <button data-category="Adventure">Adventure</button>
      <button data-category="Arcade">Arcade</button>
      <button data-category="Puzzle">Puzzle</button>
      <button data-category="Racing">Racing</button>
      <button data-category="Sports">Sports</button>
      <button data-category="Shooting">ƨʜooting</button>
      <button data-category="Multiplayer">Multiplayer</button>
      <button data-category="Horror">Horror</button>
      <button data-category="Strategy">Strategy</button>
      <button data-category="Simulation">Simulation</button>
      <button data-category="Idle">Idle</button>
      <button data-category="Rhythm">Rhythm</button>
      <button data-category="Platformer">Platformer</button>
      <button data-category="Fighting">Fighting</button>
      <button data-category="Tower Defense">Tower Defense</button>
      <button data-category="Sandbox">Sandbox</button>
      <button data-category="Educational">Educational</button>
      <button data-category="Other">Other</button>
    </div>

    <div id="discoveryContainer">Loading ϱames...</div>
  </main>

  <footer>
    <a href="/system/pages/sources.html">Sources</a>
    <a href="/system/pages/contributors.html">Contribute</a>
    <a href="/system/pages/discord.html">Discord</a>
    <a href="/system/pages/bugsNfixes.html">Bugs & Fixes</a>
    <a href="/system/pages/contact.html">Socials</a>
    <a href="/system/pages/version-log.html" id="footerVersion">Version loading...</a>
  </footer>

  <button id="toTopBtn">⬆ Top</button>

  <!-- JS -->
  <script src="/system/js/settings.js" defer></script>
  <script src="/system/js/main.js" defer></script>
  <script src="/system/js/all.js" defer></script>

  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    const container = document.getElementById("discoveryContainer");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const buttons = document.querySelectorAll(".category-buttons button");
    const fallbackImage = "/system/images/404_blank.png";
    const fallbackLink = "https://vvannasmile.github.io/source/dino/";

    let assets = [];

    // === Load from Sheets API (Unified Loader) ===
    try {
      const sheetUrl = "https://script.google.com/macros/s/AKfycbzw69RTChLXyis4xY9o5sUHtPU32zaMeKaR2iEliyWBsJFvVbTbMvbLNfsB4rO4gLLzTQ/exec";
      const res = await fetch(sheetUrl);
      const data = await res.json();
      assets = Array.isArray(data) ? data : [];
    } catch (err) {
      console.error("Failed to load Sheets data:", err);
      container.innerHTML = "<p>⚠ Failed to load ϱame data.</p>";
      return;
    }

    function renderAssets(list) {
      container.innerHTML = "";
      if (!list.length) {
        container.innerHTML = "<p>No ϱames found.</p>";
        return;
      }

      list.forEach(asset => {
        const card = document.createElement("div");
        card.className = "game-card";
        if (asset.status?.toLowerCase() === "soon") card.classList.add("soon");

        const img = document.createElement("img");
        img.src = asset.image?.trim() || fallbackImage;
        img.alt = asset.title || "Untitled";
        img.onerror = () => (img.src = fallbackImage);

        const title = document.createElement("h3");
        title.textContent = asset.title || "Untitled";

        const author = document.createElement("p");
        author.textContent = asset.author || "Unknown";

        const link = document.createElement("a");
        link.href = asset.link?.trim() || fallbackLink;
        link.target = "_blank";
        link.rel = "noopener";

        link.appendChild(img);
        link.appendChild(title);
        link.appendChild(author);
        card.appendChild(link);
        container.appendChild(card);
      });
    }

    renderAssets(assets);

    // --- Category filter ---
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const cat = btn.dataset.category.toLowerCase();
        const filtered = assets.filter(a => a.category?.toLowerCase() === cat);
        renderAssets(filtered);
      });
    });

    // --- Search ---
    function doSearch() {
      const q = searchInput.value.toLowerCase().trim();
      const filtered = assets.filter(a =>
        a.title?.toLowerCase().includes(q) ||
        a["sub-category"]?.toLowerCase().includes(q)
      );
      renderAssets(filtered);
    }
    searchBtn.addEventListener("click", doSearch);
    searchInput.addEventListener("keydown", e => e.key === "Enter" && doSearch());

    // --- Profile Pic ---
    const savedPic = localStorage.getItem("profilePic");
    if (savedPic) document.getElementById("pfp").src = savedPic;

    // --- Dashboard Toggle ---
    const dashboardBtn = document.getElementById("dashboardBtn");
    const dashboardMenu = document.getElementById("dashboardMenu");

    dashboardMenu.style.display = "none";
    dashboardBtn.addEventListener("click", e => {
      e.stopPropagation();
      const isVisible = dashboardMenu.style.display === "flex";
      dashboardMenu.style.display = isVisible ? "none" : "flex";
    });
    document.addEventListener("click", e => {
      if (!dashboardMenu.contains(e.target) && e.target !== dashboardBtn) {
        dashboardMenu.style.display = "none";
      }
    });
  });
  </script>
</body>
</html>
