<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WannaSmile | Home</title>
  <link rel="icon" href="system/images/favicons/logoo.png" />
  <meta name="author" content="WannaSmile by Rhap5ody" />
  <meta name="keywords" content="github, repository, source, library" />

  <!-- Styles -->
  <link rel="stylesheet" href="system/css/themes.css" />
  <link rel="stylesheet" href="system/css/main.css" />
  <link rel="stylesheet" href="system/css/loading-screen.css" />
  <link rel="stylesheet" href="system/css/commands.css" />

  <!-- Discord Widget -->
  <script async defer src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3"></script>
  <script>
    window.addEventListener("load", () => {
      if (typeof Crate !== "undefined") {
        new Crate({
          server: '1273329263923302430',
          channel: '1329289920845713471'
        });
      }
    });
  </script>

  <!-- Social Meta -->
  <meta property="og:title" content="WannaSmile" />
  <meta property="og:description" content="Welcome to WannaSmile ‚Äî a library full of content! Enjoy it in your free time." />
  <meta property="og:image" content="https://www.yourwebsite.com/path/to/your/preview-image.jpg" />
  <meta property="og:url" content="https://vvannasmile.github.io/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="WannaSmile.github.io" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="WannaSmile" />
  <meta name="twitter:description" content="A fun, content-filled library to make you smile." />
  <meta name="twitter:image" content="https://www.yourwebsite.com/path/to/your/preview-image.jpg" />

  <!-- Inline custom styles -->
<style>
  /* ==========================================
     Top Bar (Header + Quotes unified)
     ========================================== */
  #topBar {
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 20;
    background: var(--header-bg);
  }

  #topBar header {
    z-index: 21;
  }

  /* Quotes Bar */
  #quoteWrapper {
    position: relative;
    width: 100vw;
    height: 30px;
    overflow: hidden;
    background: #1d201f;
    display: flex;
    align-items: center;
  }

  #quoteBox {
    position: absolute;
    white-space: nowrap;
    font-weight: bold;
    color: #fff;
    transform: translateX(100%);
    user-select: none;
    cursor: default;
    font-size: 1.0em;
    text-decoration: none;
    font-family: monospace;
    font-weight: bold;
  }
</style>

<!-- ================================
     ANNOUNCEMENT POPUP ‚Äî OPTION A
================================ -->

<!-- Dark blurred background -->
<div id="popup-overlay" class="announcement-overlay"></div>

<!-- Centered modal -->
<div id="announcement-modal" class="announcement-modal">
  
  <div class="announcement-header">
    <h2 class="announcement-title">Break Announcement</h2>
  </div>

  <div class="announcement-content">
    <p>
      Hello everyone!<br><br>
      Rhap5ody here, Im here to announce that i will
      be taking a break from updating the website for a while.
      <br><br>
      <strong>When will I come back?</strong><br>
      Sometime before <strong>May 16th, 2025</strong>
      <br><br>
      <strong>Why go on break?</strong><br>
      i feel im not at the level i should be at right now,
      ill go on break so i can learn to become a better website design for y'all.
      <br><br>
      <strong>What does this mean for YOU?</strong><br>
      not much actually! i will be continuing to add all assets up until page 5!
      (page 6 to 10 is not guaranteed, but ill try to grt them filled out).
      <br><br>
      <strong>Suggestions & Bug Fixes</strong><br>
      All suggestions are welcome to be continued to be asked of me,
      I will do as much as I can to include everyone‚Äôs suggestions 
      and get sources for the assets people want to enjoy the most.
      And of course I will be swift to deliver with bug fixes and new content,
      fair well for now but not forever!
      <br><br>
      <strong>Hide or Don‚Äôt show again</strong>
      Click the buttons at the bottom but know that either if you read or not you can click
      ‚Äúdon‚Äôt show again‚Äù without any worry to forget or miss out on the announcement, I will be adding the page link to the header! 
      <strong>‚ÄúAnnouncement‚Äù <‚Äî-</strong>
    </p>
  </div>

  <div class="announcement-buttons">
    <button id="close-btn" class="modal-btn modal-close disabled">Close (5)</button>
    <button id="never-btn" class="modal-btn modal-hide disabled">Don‚Äôt Show Again (5)</button>
  </div>

</div>

<script>
  const modal = document.getElementById("announcement-modal");
  const overlay = document.getElementById("popup-overlay");
  const closeBtn = document.getElementById("close-btn");
  const neverBtn = document.getElementById("never-btn");

  // check if user clicked "don't show again"
  if (!localStorage.getItem("announcement_hidden")) {
    overlay.style.display = "block";
    modal.style.display = "block";

    // Wait 10ms so CSS transition triggers
    setTimeout(() => modal.classList.add("show"), 10);

    // Start countdown only when modal is visible
    const observer = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting) {
        startCountdown();
        observer.disconnect();
      }
    }, { threshold: 0.6 });

    observer.observe(modal);
  }

  function startCountdown() {
    let timer = 5;

    const interval = setInterval(() => {
      timer--;

      closeBtn.textContent = `Close (${timer})`;
      neverBtn.textContent = `Don't Show Again (${timer})`;

      if (timer <= 0) {
        clearInterval(interval);
        closeBtn.textContent = "Close";
        neverBtn.textContent = "Don't Show Again";

        closeBtn.classList.remove("disabled");
        neverBtn.classList.remove("disabled");
      }
    }, 1000);
  }

  // Close only for the session (until refresh)
  closeBtn.addEventListener("click", () => {
    modal.classList.remove("show");
    setTimeout(() => {
      modal.style.display = "none";
      overlay.style.display = "none";
    }, 200);
  });

  // Close permanently (localStorage)
  neverBtn.addEventListener("click", () => {
    localStorage.setItem("announcement_hidden", "true");
    modal.classList.remove("show");
    setTimeout(() => {
      modal.style.display = "none";
      overlay.style.display = "none";
    }, 200);
  });
</script>
  
</head>

<body theme="classic">
  <!-- Preloader -->
  <div id="preloader" class="preloader">
    <div class="loader-gif">
      <img id="loaderImage" src="system/images/GIF/loading.gif" alt="Loading animation" />
    </div>
    <div class="load-progress-bar"><div id="progressBar" class="load-progress-fill"></div></div>
    <div id="loaderText" class="loading-text">Loading...</div>
  </div>
  
  <div id="topBar">
    <!-- Header -->
    <header>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="favorites.html">Favorites</a>
        <a href="system/pages/discovery.html">Discovery</a>
        <a href="system/pages/settings.html">Settings</a>
        <a href="system/pages/support.html">Support</a>
        <a href="info.html">Info</a>
        <a href="announcement.html">announcement</a>
        <div class="pages-anchor">
          <button class="arrowleft" onclick="prevPage()"><img src="system/icons/left.png" alt="Previous page" /></button>
          <span class="page-indicator">...</span>
          <button class="arrowright" onclick="nextPage()"><img src="system/icons/right.png" alt="Next page" /></button>
        </div>
      </nav>

      <div class="header-controls">
        <div class="search-box">
          <input id="searchInputHeader" type="text" placeholder="Search œ±ames..." />
          <button id="searchBtnHeader"><img src="system/icons/search.png" alt="Search" /></button>
        </div>
        <a href="system/pages/profile.html"><img id="pfp" src="system/icons/profile.png" alt="Profile" /></a>
        <button id="dashboardBtn"><img src="system/icons/dashboard.png" alt="Dashboard" /></button>
      </div>
    </header>

    <!-- Quotes Bar -->
    <div id="quoteWrapper">
      <p id="quoteBox">Loading...</p>
    </div>
  </div>
    
  <!-- Dashboard -->
  <aside id="dashboardMenu" class="dashboard-menu">
    <p>pages</p>
    <a href="https://bguhm.github.io/music-player.html">Music Player</a>
    <a href="system/pages/settings-themes.html">Themes</a>
    <a href="system/pages/credits.html">Credits</a>
    <p>dev tools</p>
    <a href="system/pages/devtools/rawfetch.html">raw image link fetcher</a>
    <a href="system/pages/devtools/textflip.html">text flip/mirror</a>
    <p>other</p>
    <a href="system/pages/alt.html">Alternative Links</a>
  </aside>

  <!-- Main -->
  <main>
    <div id="container">Loading assets...</div>
  </main>

      <button id="toTopBtn">‚¨Ü Top</button>

  <footer>
    <a href="system/pages/sources.html">Sources</a>
    <a href="system/pages/contributors.html">Contribute</a>
    <a href="system/pages/discord.html">Discord</a>
    <a href="system/pages/bugsNfixes.html">Bugs & Fixes</a>
    <a href="system/pages/contact.html">Socials</a>
    <a href="system/archive/index.html">archived versions</a>
    <a href="system/pages/update-logs.html" id="footerVersion">Version loading...</a>
  </footer>

  <!-- JS: Core, UI -->
  <script src="system/js/settings.js" defer></script>
  <script src="system/js/commands.js" defer></script>
  <script src="system/js/main.js" defer></script>
  <script src="system/js/searcherror.js" defer></script>
  <script src="system/js/index.js" defer></script>
  <script src="system/js/version.js" defer></script>
  <script src="system/js/all.js" defer></script>

  <!-- üñ± Custom Cursor -->
  <!--<script src="system/js/cursor.js" defer></script>-->

  <!-- Quotes Scroll (merged) -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const wrapper = document.getElementById("quoteWrapper");
    const box = document.getElementById("quoteBox");
    const jsonPath = "../system/json/quotes.json";

    let quotes = [];
    let pos = 0;
    let lastTime = null;

    // Base speeds (px/sec)
    const baseSpeed = 120;
    const slowSpeed = 70;
    const slowerSpeed = 30;

    // State flags
    let currentSpeed = baseSpeed;
    let isHoveringBox = false;
    let isHoveringText = false;
    let isMouseDown = false;

    async function loadQuotes() {
      try {
        const res = await fetch(jsonPath);
        const data = await res.json();
        quotes = Array.isArray(data) && data.length ? data : ["No quotes found"];
        start();
      } catch {
        quotes = ["‚ö† Error loading quotes"];
        start();
      }
    }

    function setQuote() {
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      box.textContent = quote;
      pos = wrapper.offsetWidth;
      box.style.transform = `translateX(${pos}px)`;
    }

    function updateSpeed() {
      if (isMouseDown) currentSpeed = 0;
      else if (isHoveringText) currentSpeed = slowerSpeed;
      else if (isHoveringBox) currentSpeed = slowSpeed;
      else currentSpeed = baseSpeed;
    }

    function animate(time) {
      if (lastTime !== null) {
        const dt = (time - lastTime) / 1000;
        pos -= currentSpeed * dt;
        box.style.transform = `translateX(${pos}px)`;
        if (pos + box.offsetWidth < 0) setQuote();
      }
      lastTime = time;
      requestAnimationFrame(animate);
    }

    function start() {
      setQuote();
      requestAnimationFrame(animate);
    }

    // Hover + click logic
    wrapper.addEventListener("mouseenter", () => { isHoveringBox = true; updateSpeed(); });
    wrapper.addEventListener("mouseleave", () => { isHoveringBox = false; isHoveringText = false; updateSpeed(); });
    box.addEventListener("mouseenter", () => { isHoveringText = true; updateSpeed(); });
    box.addEventListener("mouseleave", () => { isHoveringText = false; updateSpeed(); });
    wrapper.addEventListener("mousedown", () => { isMouseDown = true; updateSpeed(); });
    wrapper.addEventListener("mouseup", () => { isMouseDown = false; updateSpeed(); });

    loadQuotes();
  });
  </script>

  <script>
  /* ==========================================================
     LOAD USER PROFILE PREVIEW (Persistent Small PFP)
     ========================================================== */
  document.addEventListener("DOMContentLoaded", () => {
    const pfp = document.getElementById("pfp");
    const defaultPic = "system/icons/profile.png";

    const currentUser = localStorage.getItem("currentUser");
    if (!currentUser) {
      pfp.src = defaultPic;
      return;
    }

    // Try to load user data
    const userData = JSON.parse(localStorage.getItem("user_" + currentUser) || "{}");
    const profileData = JSON.parse(localStorage.getItem("profile_" + currentUser) || "{}");

    // Resolve preferred image (profileData first, fallback to default)
    const userPic = profileData.pic || defaultPic;

    // Update small header PFP
    pfp.src = userPic;

    // Optionally store a mini cache so other pages load faster
    const cachedPreview = {
      username: userData.username || profileData.nickname || currentUser,
      pic: userPic
    };
    localStorage.setItem("preview_" + currentUser, JSON.stringify(cachedPreview));
  });
</script>

      <script>
  const toTopBtn = document.getElementById("toTopBtn");

  // Use one scroll listener
  window.addEventListener("scroll", () => {
    const scrollY = window.scrollY;

    // Toggle visibility
    if (scrollY > 250) {
      toTopBtn.classList.add("show");
    } else {
      toTopBtn.classList.remove("show");
    }
  });

  // Smooth scroll to top
  toTopBtn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
</script>

/* ==========================================================
   INTERACTIVE 404 CHECK + CUSTOM DOMAIN FIX
   ----------------------------------------------------------
   - Checks links when clicked.
   - If link contains "https://wanna5mile.github.io/", 
     it replaces with "https://wanna5mile.github.io./".
   - Still includes 404 safety check for relative links.
   ========================================================== */
document.addEventListener("DOMContentLoaded", () => {
  document.body.addEventListener("click", async (e) => {
    const a = e.target.closest("a");
    if (!a) return;

    let href = a.getAttribute("href");
    if (!href) return;

    // --- üîç Handle the custom domain correction ---
    if (href.includes("https://wanna5mile.github.io/")) {
      e.preventDefault(); // stop default navigation
      const fixed = href.replace("https://wanna5mile.github.io/", "https://wanna5mile.github.io./");
      window.open(fixed, a.target || "_blank"); // open in new tab (or same if target specified)
      return;
    }

    // --- üß≠ Skip external or special links ---
    if (href.startsWith("http") || href.startsWith("#") || href.startsWith("mailto:")) return;

    // --- üìÑ Construct absolute URL for 404 check ---
    const url = new URL(href, window.location.origin);

    try {
      const res = await fetch(url.href, { method: "HEAD" });

      if (!res.ok) {
        e.preventDefault();
        console.warn(`‚ö† Broken link detected: ${url.href}`);
        window.location.href = "/404.html";
      }
    } catch (err) {
      console.warn(`Network error checking ${url.href}:`, err);
    }
  });
});
</script>
</body>
</html>
