<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smooth Quote Scroll</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
  }

  #quoteBox {
    position: relative;
    width: 100vw;
    height: 30px;
    background: #1d201f;
    overflow: hidden;
    display: flex;
    align-items: center;
  }

  #quoteText {
    position: absolute;
    white-space: nowrap;
    font-size: 20px;
    color: white;
  }
</style>
</head>
<body>
  <div id="quoteBox">
    <div id="quoteText">Loading...</div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const box = document.getElementById("quoteBox");
  const text = document.getElementById("quoteText");
  const jsonPath = "system/json/quotes.json";

  // Load quotes
  try {
    const res = await fetch(jsonPath);
    const data = await res.json();
    const quotes = Array.isArray(data) && data.length ? data : ["No quotes found"];
    text.textContent = quotes[Math.floor(Math.random() * quotes.length)];
  } catch {
    text.textContent = "âš  Error loading quotes";
  }

  // Wait a frame to ensure width is known
  requestAnimationFrame(() => {
    // Scroll variables
    let pos = box.offsetWidth; // start just outside the right edge
    let lastTime = null;

    const baseSpeed = 80;   // px/sec
    const slowSpeed = 40;   // slower
    const slowerSpeed = 20; // even slower

    let currentSpeed = baseSpeed;
    let isHoveringBox = false;
    let isHoveringText = false;
    let isMouseDown = false;

    function updateSpeed() {
      if (isMouseDown) currentSpeed = 0;
      else if (isHoveringText) currentSpeed = slowerSpeed;
      else if (isHoveringBox) currentSpeed = slowSpeed;
      else currentSpeed = baseSpeed;
    }

    function animate(time) {
      if (lastTime != null) {
        const dt = (time - lastTime) / 1000; // seconds since last frame
        pos -= currentSpeed * dt;
        text.style.transform = `translateX(${pos}px)`;

        // When fully off left, reset just past right edge
        if (pos + text.offsetWidth < 0) {
          pos = box.offsetWidth;
        }
      }
      lastTime = time;
      requestAnimationFrame(animate);
    }

    // Hover + mouse events
    box.addEventListener("mouseenter", () => { isHoveringBox = true; updateSpeed(); });
    box.addEventListener("mouseleave", () => { isHoveringBox = false; isHoveringText = false; updateSpeed(); });
    text.addEventListener("mouseenter", () => { isHoveringText = true; updateSpeed(); });
    text.addEventListener("mouseleave", () => { isHoveringText = false; updateSpeed(); });
    box.addEventListener("mousedown", () => { isMouseDown = true; updateSpeed(); });
    box.addEventListener("mouseup", () => { isMouseDown = false; updateSpeed(); });

    // Start animation
    requestAnimationFrame(animate);
  });
});
</script>
</body>
</html>
